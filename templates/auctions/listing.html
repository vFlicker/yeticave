{% extends "base.html" %}
{% load auctions_extras %}

{% block content %}
    <main>
        <section class="lot-item container">
            <div class="lot-item__header">
                <h2>{{ listing.title }}</h2>

                {% if user.is_authenticated %}
                    {% include "auctions/_close_bid.html" %}
                {% endif %}
            </div>

            <div class="lot-item__content">
                <div class="lot-item__left">
                    <img src="{{ listing.image_url }}" class="lot-item__image" width="730" height="548" alt="{{ listing.title }}" />

                    <div class="lot-item__row">
                        <p class="lot-item__category">
                            Category: <span>{{ listing.category }}</span>
                        </p>
                        {% if user.is_authenticated %}
                            {% include "watchlist/_toggle_watchlist.html" with listing_id=listing.id width="31" height="33" %}
                        {% endif %}
                    </div>

                    <p class="lot-item__description">{{ listing.description }}</p>

                    <div class="lot-item__comments comments">
                        <h2>Comments</h2>

                        {% if user.is_authenticated and not is_creator %}
                            {% include "auctions/_add_comment.html" %}
                        {% endif %}

                        <ul class="comment__list">
                            {% for comment in comments %}
                                {% include "auctions/_comment.html" %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                <div class="lot-item__right">
                    <div class="bet">
                        <div class="lot-item__cost-state">
                            <div class="lot-item__rate">
                                <div class="lot-item__amount">Current price</div>
                                <div class="lot-item__cost">{{ listing.current_price | usd}}</div>
                            </div>
                        </div>

                        {% if user.is_authenticated and not is_creator %}
                            {% include "auctions/_add_bid.html" %}
                        {% endif %}
                    </div>

                    <div class="history">
                        <h3>History of rates (<span>{{ bids | length }}</span>)</h3>
                        <table class="history__list">
                            {% for bid in bids %}
                                {% include "auctions/_bid.html" %}
                            {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>
{% endblock %}